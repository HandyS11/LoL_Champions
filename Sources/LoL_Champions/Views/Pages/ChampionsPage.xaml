<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:VM;assembly=VM"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:converters="clr-namespace:LoL_Champions.Converters"
             xmlns:parts="clr-namespace:LoL_Champions.Views.Parts"
             xmlns:local="clr-namespace:LoL_Champions.Views.Pages"
             x:Class="LoL_Champions.Views.Pages.ChampionsPage"
             x:DataType="local:ChampionsPage"
             Title="Champions">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Ajouter"
                     Command="{Binding _navigation.AddChampionCommand}"/>
    </ContentPage.ToolbarItems>
    
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Loaded"
                                        Command="{Binding _vm.LoadChampionsCommand}"/>
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <converters:Base64ToImageSourceConverter x:Key="imageConverter"/>
        <toolkit:ItemTappedEventArgsConverter x:Key="ItemTappedEventArgsConverter" />

        <Style TargetType="ImageButton" x:Key="navigationButton">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="*, Auto">
        <ListView ItemsSource="{Binding _vm.Champions}"
                  SelectionMode="None">
            <ListView.Behaviors>
                <toolkit:EventToCommandBehavior EventName="ItemTapped"
                                                EventArgsConverter="{StaticResource ItemTappedEventArgsConverter}"
                                                Command="{Binding _navigation.ChampionCommand}"/>
            </ListView.Behaviors>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="vm:ChampionVM">
                    <!--<ImageCell Text="{Binding Name}"
                               TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}"
                               Detail="{Binding Class}"
                               DetailColor="{StaticResource Gray400}"/>-->

                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Modifier"
                                           BackgroundColor="{StaticResource Gray500}" />
                                <SwipeItem Text="Supprimer"
                                           BackgroundColor="Red" />
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <SwipeView.Content>
                            <StackLayout Orientation="Vertical">
                                <StackLayout Orientation="Horizontal">
                                    <Image Source="{Binding Icon, Converter={StaticResource imageConverter}}"
                                           WidthRequest="50"
                                           HeightRequest="50"/>
                                    <StackLayout Orientation="Vertical">
                                        <Label Text="{Binding Name}"
                                               VerticalOptions="CenterAndExpand" 
                                               HorizontalOptions="StartAndExpand"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding Class}"
                                               VerticalOptions="CenterAndExpand" 
                                               HorizontalOptions="StartAndExpand"
                                               FontSize="Caption"/>
                                    </StackLayout>
                                </StackLayout>
                                <BoxView HeightRequest="1" BackgroundColor="Gray" Margin="10,10,10,0"/>
                            </StackLayout>
                        </SwipeView.Content>
                    </SwipeView>
                    
                    <!--<ViewCell>
                        <SwipeView>
                            <SwipeView.LeftItems>
                                <SwipeItems>
                                    <SwipeItem Text="Editer"
                                               BackgroundColor="LightGreen"
                                               Invoked="SwipeItem_OnInvoked"/>
                                    <SwipeItem Text="Supprimer"
                                               BackgroundColor="LightPink"
                                               Invoked="SwipeItem_OnInvoked"/>
                                </SwipeItems>
                            </SwipeView.LeftItems>
                            <Grid RowDefinitions="Auto, Auto"
                                  ColumnDefinitions="Auto, *">
                                <Image Grid.RowSpan="2"
                                       Margin="5"
                                       Aspect="AspectFill"
                                       Source="{Binding Icon, Converter={StaticResource imageConverter}}"/>
                                <Label Grid.Column="1"
                                       Text="{Binding Name}"
                                       FontSize="20"/>
                                <Label Grid.Column="1" Grid.Row="1"
                                       Text="{Binding Class}"
                                       TextColor="{StaticResource Gray400}"/>
                            </Grid>
                        </SwipeView>
                    </ViewCell>-->

                    <!--<ViewCell>
                        <Grid RowDefinitions="*, *" ColumnDefinitions="50, *, Auto">
                            <Image Grid.RowSpan="2"
                                   Margin="5"
                                   Aspect="AspectFill"
                                   Source="{Binding Icon, Converter={StaticResource imageConverter}}"/>
                            <Label Grid.Column="1"
                                   Text="{Binding Name}"
                                   FontSize="20"/>
                            <Label Grid.Column="1" Grid.Row="1"
                                   Text="{Binding Class}"
                                   TextColor="{StaticResource Gray400}"/>

                            <HorizontalStackLayout Grid.Column="2"
                                                   Grid.RowSpan="2">
                                <ImageButton Source="edit.png"
                                             BackgroundColor="Transparent"
                                             Padding="3">
                                    <ImageButton.Behaviors>
                                        <toolkit:IconTintColorBehavior TintColor="{StaticResource Primary}"/>
                                    </ImageButton.Behaviors>
                                </ImageButton>
                                <ImageButton Source="delete.png"
                                             BackgroundColor="Transparent"
                                             Padding="3">
                                    <ImageButton.Behaviors>
                                        <toolkit:IconTintColorBehavior TintColor="{StaticResource Primary}"/>
                                    </ImageButton.Behaviors>
                                </ImageButton>
                            </HorizontalStackLayout>
                        </Grid>
                    </ViewCell>-->
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <VerticalStackLayout Grid.Row="1">
            <HorizontalStackLayout HorizontalOptions="Center">
                <ImageButton Source="arrow_back.png"
                             HeightRequest="60"
                             WidthRequest="60"
                             Style="{StaticResource navigationButton}"
                             Command="{Binding _vm.PreviousPageCommand}">
                    <ImageButton.Behaviors>
                        <toolkit:IconTintColorBehavior TintColor="White"/>
                    </ImageButton.Behaviors>
                </ImageButton>
                <Label VerticalOptions="Center"
                       Margin="8,0">
                    <Label.Text>
                        <MultiBinding StringFormat="{}{0} / {1}">
                            <Binding Path="_vm.HumanIndex"/>
                            <Binding Path="_vm.NbPages"/>
                        </MultiBinding>
                    </Label.Text>
                </Label>
                <ImageButton Source="arrow_forward.png"
                             HeightRequest="60"
                             WidthRequest="60"
                             Style="{StaticResource navigationButton}"
                             Command="{Binding _vm.NextPageCommand}">
                    <ImageButton.Behaviors>
                        <toolkit:IconTintColorBehavior TintColor="White"/>
                    </ImageButton.Behaviors>
                </ImageButton>
            </HorizontalStackLayout>
            <parts:SeparatorView/>
        </VerticalStackLayout>
    </Grid>
</ContentPage>